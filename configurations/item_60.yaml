## Define inputs to perform statistics on
global_attributes:
  title: ITEM 
sources:
  - product: ls5_nbar_albers
    name: ITEM 
    measurements: [blue, green, red, nir, swir1, swir2]
    group_by: solar_day
#    source_filter:
#      product: ls5_level1_scene
#      gqa_cep90: (-0.25, 0.25)
    masks:
      - product: ls5_pq_albers
        measurement: pixelquality
        group_by: solar_day
        fuse_func: datacube.helpers.ga_pq_fuser
        flags:
          contiguous: True
          cloud_acca: no_cloud
          cloud_fmask: no_cloud
          cloud_shadow_acca: no_cloud_shadow
          cloud_shadow_fmask: no_cloud_shadow
          blue_saturated: False
          green_saturated: False
          red_saturated: False
          nir_saturated: False
          swir1_saturated: False
          swir2_saturated: False

  - product: ls7_nbar_albers
    name: ITEM
    measurements: [blue, green, red, nir, swir1, swir2]
    group_by: solar_day
#    source_filter:
#      product: ls7_level1_scene
#      gqa_cep90: (-0.25, 0.25)
    masks:
      - product: ls7_pq_albers
        measurement: pixelquality
        group_by: solar_day
        fuse_func: datacube.helpers.ga_pq_fuser
        flags:
          contiguous: True
          cloud_acca: no_cloud
          cloud_fmask: no_cloud
          cloud_shadow_acca: no_cloud_shadow
          cloud_shadow_fmask: no_cloud_shadow
          blue_saturated: False
          green_saturated: False
          red_saturated: False
          nir_saturated: False
          swir1_saturated: False
          swir2_saturated: False


  - product: ls8_nbar_albers
    name: ITEM
    measurements: [blue, green, red, nir, swir1, swir2]
    group_by: solar_day
#    source_filter:
#      product: ls8_level1_scene
#      gqa_cep90: (-0.25, 0.25)
    masks:
      - product: ls8_pq_albers
        measurement: pixelquality
        group_by: solar_day
        fuse_func: datacube.helpers.ga_pq_fuser
        flags:
          contiguous: True
          cloud_acca: no_cloud
          cloud_fmask: no_cloud
          cloud_shadow_acca: no_cloud_shadow
          cloud_shadow_fmask: no_cloud_shadow
          blue_saturated: False
          green_saturated: False
          red_saturated: False
          nir_saturated: False
          swir1_saturated: False
          swir2_saturated: False


## Define whether and how to chunk over time
date_ranges:
  start_date: 1986-01-01
  end_date: 2017-01-01
  stats_duration: 31y
  step_size: 31y
  type: simple

## Define output directory and file structure
#location: '/short/v10/datacube/wofs-summary'
#location: '/g/data/r78/bxb547/TIDE_MODEL/output_low'
#location: '/g/data/r78/ITEM/MERGE_POLY'
location: '/g/data/r78/ITEM/OUTPUT_GA'
#location: '/g/data/v10/intertidal/output_data'

input_region:
#  tile: [12, -43]
  from_file: /g/data/r78/ITEM/TM_compute.shp
#  from_file: /g/data/r78/intertidal/low_composite_20.shp
#
storage:
  driver: NetCDFCF
  #driver: Geotiff

  crs: EPSG:3577
  tile_size:
          x: 100000.0
          y: 100000.0
  resolution:
          x: 25
          y: -25
  chunking:
      x: 200
      y: 200
      time: 1
  dimension_order: [time, y, x]

## Computational
computation:
  chunking:
    x: 800
    y: 800

## Define statistics to perform and how to store the data

output_products:
 - name: med_ndwi
   statistic: medndwi
   output_params:
      zlib: True
      fletcher32: True
   file_path_template: '{x}_{y}_{epoch_start:%Y%m%d}_{epoch_end:%Y%m%d}_{stat_name}_PER_{percent}.nc'
   product_type: ITEM

# - name: standard_deviation 
#   statistic: std
#   output_params:
#      zlib: True
#      fletcher32: True
#   file_path_template: '{x}_{y}_{epoch_start:%Y%m%d}_{epoch_end:%Y%m%d}_{stat_name}_PER_{percent}.nc'
#   product_type: ITEM

# - name: relative
#   statistic: rel
#   output_params:
#      zlib: True
#      fletcher32: True
#   file_path_template: '{x}_{y}_{epoch_start:%Y%m%d}_{epoch_end:%Y%m%d}_{stat_name}_PER_{percent}.nc'
#   product_type: ITEM
# - name: tidal_count
#   statistic: clearcount
#   output_params:
#      zlib: True
#      fletcher32: True
#   file_path_template: 'PIXEL_COUNT_{x}_{y}_{epoch_start:%Y%m%d}_{epoch_end:%Y%m%d}_PER_{percent}.nc'
#   product_type: ITEM

tide_class:
  product: item
  range_percent: 10
  percent: 60
  #Filter in/out LS7 data By default ls7_slc_off is set meaning datasets not included after 2003-05-01
  #In case we need all data just set this parameter or comment it out in case of we don't need post SLC dates
  ls7_slc_off: False
  # This is for deciding low high percentile based on global dates
  global_epoch_start: 1986-01-01
  global_epoch_end: 2017-01-01
