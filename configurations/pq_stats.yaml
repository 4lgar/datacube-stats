# See https://gaautobots.atlassian.net/browse/ATX-159

## Define inputs to perform statistics on
sources:
  - product: ls5_pq_albers
    group_by: solar_day
    mask_nodata: False

  - product: ls7_pq_albers
    group_by: solar_day
    mask_nodata: False

  - product: ls8_pq_albers
    group_by: solar_day
    mask_nodata: False



## Define whether and how to chunk over time
date_ranges:
  start_date: 2008-01-01
  end_date: 2011-01-01
  stats_duration: 12m
  step_size: 12m

## Define output directory and file structure
location: '/g/data/u46/users/dra547/pq_stats'

storage:
  driver: NetCDFCF

  crs: EPSG:3577
  tile_size:
          x: 100000.0
          y: 100000.0
  resolution:
          x: 25
          y: -25
  chunking:
      x: 200
      y: 200
      time: 1
  dimension_order: [time, y, x]

## Computational
computation:
  chunking:
    x: 2000
    y: 2000

#input_region:
##  tile: [12, -43]
#  from_file: /g/data/u46/users/dra547/MDBA/config/mdba_simplified.shp


## Define statistics to perform and how to store the data
output_products:
 - name: pq_stats
   statistic: masked_count
   statistic_args:
     flags:
       contiguous: True
       cloud_acca: no_cloud
       cloud_fmask: no_cloud
       cloud_shadow_acca: no_cloud_shadow
       cloud_shadow_fmask: no_cloud_shadow
       blue_saturated: False
       green_saturated: False
       red_saturated: False
       nir_saturated: False
       swir1_saturated: False
       swir2_saturated: False
   output_params:  # TODO Add check for this
     zlib: True
     fletcher32: True
   file_path_template: '{epoch_start:%Y}/{x}/SR_LS5_N_PCT_25_3577_{x}_{y}_{epoch_start:%Y%m%d}_{epoch_end:%Y%m%d}.nc'
